#!/usr/bin/env bash
set -euo pipefail

: "${CRON_TOKEN:?CRON_TOKEN requerido}"
BACKEND_BASE="${BACKEND_BASE:-https://zupply-backend.onrender.com}"

for i in 1 2 3; do
  if curl -fsS -X POST \
       -H "Authorization: Bearer $CRON_TOKEN" \
       "$BACKEND_BASE/api/auth/meli/sync-pending"; then
    exit 0
  fi
  sleep $((i*10))
done

exit 1
